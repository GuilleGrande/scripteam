# Story 1.1: Basic Script Upload and Text Processing

## Status
Draft

## Story
**As a** drama student,
**I want** to upload a script file (PDF or text),
**so that** I can start practicing with AI scene partners.

## Acceptance Criteria
1. User can select and upload PDF or plain text files through web interface
2. System extracts readable text from PDF files with 95%+ accuracy for standard script formats
3. Uploaded text is stored securely and displayed for user confirmation
4. Basic error handling for unsupported file types or corrupted uploads
5. File size limit of 10MB to prevent infrastructure overload during MVP

## Tasks / Subtasks
- [x] Frontend file upload component implementation (AC: 1) - **COMPLETED**
  - [x] React drag-and-drop file picker component ✓ `apps/web/src/components/ScriptUpload.tsx`
  - [x] File validation for PDF and text formats ✓ Validates `['text/plain', 'application/pdf']`
  - [x] Upload progress indicator UI ✓ Beautiful AI processing progress component
  - [ ] Add file size validation (10MB limit)
- [ ] Backend API endpoint for script upload (AC: 1, 3)
  - [ ] Implement POST /scripts endpoint with multipart/form-data support
  - [ ] Add Express middleware for file handling using multer
  - [ ] Create file storage integration with Hostinger storage
- [ ] PDF text extraction service (AC: 2)
  - [ ] Integrate PDF parsing library for text extraction
  - [ ] Implement text accuracy validation for standard script formats
  - [ ] Handle common script formatting variations
- [ ] Data persistence layer (AC: 3)
  - [ ] Create Script model in PostgreSQL database
  - [ ] Implement secure file storage with unique identifiers
  - [ ] Add user association for uploaded scripts
- [ ] Error handling and validation (AC: 4, 5)
  - [ ] Replace alert() with proper toast notification system
  - [ ] Add corruption detection for uploaded files
  - [ ] Create comprehensive error response system
- [ ] Backend integration (AC: 3)
  - [ ] Connect frontend component to actual API endpoints
  - [ ] Implement real file upload instead of mock processing
  - [ ] Add script text confirmation/editing interface

## Dev Notes

### Existing Frontend Implementation
**EXCELLENT NEWS**: The frontend ScriptUpload component is already fully implemented at `apps/web/src/components/ScriptUpload.tsx` and meets most of the AC requirements:

**Completed Features**:
- ✅ Drag and drop file upload interface
- ✅ File type validation for PDF and TXT files
- ✅ Beautiful progress indication with AI processing phases
- ✅ Professional UI using ShadCN/UI components
- ✅ Proper TypeScript implementation
- ✅ Mock processing workflow simulation

**Frontend Tech Stack Used** [Source: apps/web/package.json]:
- React 18.3.1 with TypeScript 5.8.3
- Vite build tool with SWC
- ShadCN/UI component library with Radix UI primitives
- Tailwind CSS for styling
- Lucide React for icons

### Shared Types Integration
**COMPLETED**: Shared types package created at `packages/shared/` with:
- Script, Character, User interfaces from architecture
- API types for requests/responses
- Processing status enums
- TypeScript definitions matching data models

### Required Backend Implementation
**Data Models** [Source: architecture/data-models.md#script]:
```typescript
interface Script {
  id: string;
  userId: string;
  title: string;
  originalText: string;
  detectedLanguage: 'es' | 'en' | 'mixed' | 'unknown';
  primaryLanguage: 'es' | 'en';
  processingStatus: ProcessingStatus;
  fileMetadata: FileMetadata;
  uploadedAt: Date;
}
```

**Database Schema** [Source: architecture/database-schema.md]:
```sql
CREATE TABLE scripts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(500) NOT NULL,
    original_text TEXT NOT NULL,
    detected_language VARCHAR(10) CHECK (detected_language IN ('es', 'en', 'mixed', 'unknown')),
    primary_language VARCHAR(2) CHECK (primary_language IN ('es', 'en')),
    processing_status VARCHAR(20) DEFAULT 'uploading',
    file_metadata JSONB DEFAULT '{}',
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**API Endpoint Needed** [Source: architecture/api-specification.md]:
```
POST /scripts
Content-Type: multipart/form-data
Body:
  - file: binary (PDF or text file)
  - title: string (optional)
  - expectedLanguage: string (optional: 'es', 'en', 'auto')

Response 201:
{
  "id": "uuid",
  "title": "string",
  "processingStatus": "uploading",
  "uploadedAt": "timestamp"
}
```

### File Locations
**Existing Structure**:
- Frontend component: ✅ `apps/web/src/components/ScriptUpload.tsx`
- Shared types: ✅ `packages/shared/src/types/script.ts`
- Mock types: `apps/web/src/lib/types.ts` (to be migrated to shared package)

**Still Needed**:
- Backend API: `apps/api/src/routes/scripts.ts`
- Database models: `apps/api/src/models/Script.ts`
- PDF extraction service: `apps/api/src/services/pdfExtractor.ts`
- File storage service: `apps/api/src/services/fileStorage.ts`

### Frontend Improvements Needed
1. **File Size Validation**: Add 10MB limit check in `handleFileSelection()`
2. **Error Handling**: Replace `alert()` with toast notifications (Sonner is already installed)
3. **API Integration**: Connect to real backend endpoints instead of mock processing
4. **Type Migration**: Update to use shared types from `@scripteam/shared`

### Technical Constraints
**Technology Stack Requirements** [Source: architecture/tech-stack.md]:
- Frontend: ✅ React + TypeScript (using latest versions)
- UI Framework: ✅ Using ShadCN/UI (equivalent to NativeBase for web)
- Backend needed: Node.js with Express.js 4.18+, TypeScript 5.0+
- Database needed: PostgreSQL 15+ with proper indexing
- File Handling: Need multer middleware for Express

### Testing
**Testing Standards**:
- **Frontend testing**: Use Jest + React Testing Library (need to set up)
- **Backend testing**: Use Jest + Supertest for API endpoints (need to set up)
- **Test coverage needed**:
  - File upload component interactions
  - File size validation (>10MB rejection)
  - File type validation
  - PDF text extraction accuracy
  - Database persistence
  - Error handling scenarios

### Next Steps Priority
1. **HIGH**: Set up backend API structure (`apps/api/`)
2. **HIGH**: Implement POST /scripts endpoint with file upload
3. **MEDIUM**: Add file size validation to frontend component
4. **MEDIUM**: Replace alert() with proper toast notifications
5. **LOW**: Migrate frontend types to use `@scripteam/shared`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-20 | 1.0 | Initial story creation with existing frontend analysis | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*Results from QA Agent review will be populated here after implementation.*